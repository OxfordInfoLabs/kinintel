<div class="dialog" cdkDrag cdkDragRootElement=".cdk-overlay-pane">

    <div class="dialog-title" cdkDragHandle>
        <h2 mat-dialog-title>Create Formula</h2>

        <button mat-icon-button (click)="close()">
            <mat-icon>clear</mat-icon>
        </button>
    </div>

    <div class="dialog-content" id="formula-scroll">

        <p>Use expressions to create new derived columns from other columns. Use columns show below for calculations in
            your expressions.</p>

        <div class="formula-container" *ngFor="let formula of formulas; let i = index">
            <div class="formula-fields">
                <label>
                    Column label
                    <input type="text" [(ngModel)]="formula.fieldTitle">
                </label>

                <label>
                    Expression
                    <ngx-codemirror
                        [(ngModel)]="formula.expression"
                        [options]="{lineNumbers: true,theme: 'idea',mode: 'sql'}">

                    </ngx-codemirror>
                </label>
            </div>

            <button mat-icon-button color="warn" (click)="removeFormula(i)">
                <mat-icon>remove_circle_outline</mat-icon>
            </button>
        </div>

        <ki-whitelisted-sql-functions [fields]="allColumns"></ki-whitelisted-sql-functions>
    </div>

    <div class="dialog-footer">
        <button mat-stroked-button color="primary" (click)="close()">Cancel</button>

        <button mat-flat-button color="primary" (click)="createFormula()"
                [disabled]="!_.every(this.formulas, 'fieldTitle') ||
                            !_.every(this.formulas, 'expression')">
            Create Formula
        </button>
    </div>

</div>


