<div class="configure-header">
    <ng-template [ngIf]="datasetInstance && datasetInstance.title">
        {{datasetInstance.title}}
    </ng-template>
    <ng-template [ngIf]="!datasetInstance || !datasetInstance.title">
        Data Explorer
    </ng-template>
    <button mat-icon-button mat-dialog-close>
        <mat-icon>close</mat-icon>
    </button>
</div>

<div class="configure-content">

    <rsz-layout class="row top" [directions]="showSnapshots ? ['bottom'] : ['none']"
                [rFlex]="showSnapshots">

        <rsz-layout class="cell left" [directions]="showChart ? ['right'] : ['none']" [rFlex]="true"
            [ngStyle]="{'flex-basis': showChart ? '65%' : '100%'}">
            <div class="cell-contents">
                <ki-dataset-editor [(evaluatedDatasource)]="datasetInstance" [datasource]="datasource"
                                   (dataLoaded)="dataLoaded($event)" [admin]="admin"></ki-dataset-editor>
            </div>
        </rsz-layout>

        <rsz-layout *ngIf="showChart" class="cell right" [directions]="['none']" [rFlex]="false">

            <div class="cell-contents">
                <canvas baseChart style="height: 200px"
                        [datasets]="chartData"
                        [labels]="['December', 'January', 'February', 'March', 'April']"
                        [options]="{responsive: true}"
                        [colors]="[{borderColor: 'rgba(32,166,211,0.7)',backgroundColor: 'rgba(32,166,211,0.3)'}]"
                        [legend]="false"
                        [chartType]="'line'"
                        [plugins]="[]">
                </canvas>
            </div>
        </rsz-layout>
    </rsz-layout>

    <rsz-layout *ngIf="showSnapshots" class="row bottom" [directions]="['none']" [rFlex]="false">
        <div class="p-4">
            <div class="py-4 flex justify-between">
                <div><b>Snapshot Profiles</b></div>
                <button mat-flat-button color="primary" (click)="editSnapshot(null)">
                    <mat-icon>add</mat-icon>
                    New Snapshot Profile
                </button>
            </div>
            <table *ngIf="snapshotProfiles.length">
                <thead>
                <tr>
                    <th>Title</th>
                    <th>Status</th>
                    <th>Last Started</th>
                    <th>Next Start Time</th>
                    <th></th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let snapshot of snapshotProfiles; let i = index">
                    <td>{{snapshot.title}}</td>
                    <td class="capitalize">{{snapshot.taskStatus}}</td>
                    <td>{{snapshot.taskLastStartTime}}</td>
                    <td>{{snapshot.taskNextStartTime}}</td>
                    <td class="text-right">
                        <div class="align-center justify-end">
                            <button mat-button color="primary" (click)="editSnapshot(snapshot)"> Edit</button>
                            <div class="divider"></div>
                            <button mat-button color="warn" (click)="deleteSnapshot(snapshot)"> Delete</button>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>

        </div>
    </rsz-layout>
</div>

<div class="configure-footer">
    <button mat-stroked-button mat-dialog-close color="primary">
        Cancel
    </button>
    <div class="align-center">
        <button mat-stroked-button color="primary" class="mr-2 bg-white"
                *ngIf="data && data.dataset && data.dataset.id" (click)="viewSnapshots()">
            View Snapshots
        </button>
        <button mat-stroked-button color="primary" class="mr-2 bg-white">
            Export Data
        </button>
        <button mat-flat-button color="primary" (click)="saveChanges()">
            Save Changes
        </button>
    </div>

</div>
