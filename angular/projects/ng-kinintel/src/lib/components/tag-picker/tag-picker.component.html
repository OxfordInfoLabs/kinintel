<div class="dialog" cdkDrag cdkDragRootElement=".cdk-overlay-pane">

  <div class="dialog-title" cdkDragHandle>
    <h2 mat-dialog-title>{{config.tagMenuLabel || 'Tags'}}</h2>
    <button mat-stroked-button color="primary" (click)="addNew = !addNew">
      <mat-icon>add</mat-icon>
      New {{config.tagLabel || 'Tag'}}
    </button>
    <button mat-icon-button mat-dialog-close>
      <mat-icon>clear</mat-icon>
    </button>
  </div>

  <div class="dialog-content p-0">

    @if (!addNew) {
      <div class="px-4 sm:px-6 lg:px-8 mt-0">
        <div class="flex flex-col">
          <div class="-my-2 -mx-4 sm:-mx-6 lg:-mx-8">
            <div class="inline-block min-w-full py-2 align-middle">
              <div class="mt-3 sm:mt-0 flex-1">
                <label for="mobile-search-candidate" class="sr-only">Search</label>
                <div class="flex">
                  <div class="relative flex-grow focus-within:z-10">
                    <div
                      class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                      <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                        <path fill-rule="evenodd"
                          d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"
                          clip-rule="evenodd"/>
                      </svg>
                    </div>
                    <input type="text" name="mobile-search-candidate" id="mobile-search-candidate"
                      class="block w-full rounded-none pl-10 border-t-1 border-l-0 border-gray-300"
                      placeholder="Search {{config.tagMenuLabel || 'tags'}}"
                      (keyup)="searchText.next($event.target.value)">
                  </div>
                </div>
              </div>
              <table class="min-w-full border-separate" style="border-spacing: 0">
                <thead class="bg-gray-100">
                  <tr>
                    <th scope="col"
                      class="sticky top-0 z-10 border-b border-gray-300 bg-gray-50 bg-opacity-75 py-3.5 px-4 backdrop-blur backdrop-filter">
                      <span class="sr-only">Checked</span>
                    </th>
                    <th scope="col"
                      class="sticky top-0 z-10 border-b border-gray-300 bg-gray-50 bg-opacity-75 py-3.5 px-4 text-left text-xs font-semibold text-gray-900 backdrop-blur backdrop-filter">
                      Name
                    </th>
                    <th scope="col"
                      class="sticky top-0 z-10 border-b border-gray-300 bg-gray-50 bg-opacity-75 py-3.5 px-4 text-left text-xs font-semibold text-gray-900 backdrop-blur backdrop-filter">
                      Description
                    </th>
                    <th scope="col"
                      class="sticky top-0 z-10 border-b border-gray-300 bg-gray-50 bg-opacity-75 py-3.5 px-4 text-left text-xs font-semibold text-gray-900 backdrop-blur backdrop-filter">
                      Key
                    </th>
                    <th scope="col"
                      class="sticky top-0 z-10 border-b border-gray-300 bg-gray-50 bg-opacity-75 py-3.5 px-4 backdrop-blur backdrop-filter">
                      <span class="sr-only">Edit</span>
                    </th>
                  </tr>
                </thead>
                <tbody class="bg-white">
                  @for (tag of tags; track tag) {
                    <tr (click)="activateTag(tag)"
                      class="hover:bg-gray-50 cursor-pointer">
                      <td class="whitespace-nowrap border-b border-gray-200 py-2 px-4 text-sm ">
                        @if (activeTag.key === tag.key) {
                          <mat-icon color="primary">check_circle</mat-icon>
                        }
                      </td>
                      <td class="whitespace-nowrap border-b border-gray-200 py-2 px-4 text-sm font-medium text-gray-900">
                        {{tag.tag}}
                      </td>
                      <td class="whitespace-nowrap border-b border-gray-200 py-2 px-4 text-sm text-gray-500">
                        {{tag.description}}
                      </td>
                      <td class="whitespace-nowrap border-b border-gray-200 py-2 px-4 text-sm text-gray-500">
                        {{tag.key}}
                      </td>
                      <td class="relative whitespace-nowrap border-b border-gray-200 py-2 px-4 text-right text-sm">
                        <div class="flex items-center justify-end">
                          <button mat-icon-button color="warn" (click)="removeTag(tag.key)">
                            <mat-icon>clear</mat-icon>
                          </button>
                        </div>
                      </td>
                    </tr>
                  }
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    }

    <!--        <ng-template [ngIf]="!addNew">-->
    <!--            <input class="full" type="text" placeholder="Search {{config.tagMenuLabel || 'tags'}}" (keyup)="searchText.next($event.target.value)">-->

    <!--            <table class="hover">-->
    <!--                <thead>-->
    <!--                <tr>-->
    <!--                    <th></th>-->
    <!--                    <th>Name</th>-->
    <!--                    <th>Description</th>-->
    <!--                    <th>Key</th>-->
    <!--                    <th></th>-->
  <!--                </tr>-->
<!--                </thead>-->
<!--                <tbody>-->
<!--                <tr >-->
<!--                    <td>-->
<!--                        <mat-icon color="primary" *ngIf="activeTag.key === tag.key">check_circle</mat-icon>-->
<!--                    </td>-->
<!--                    <td>{{tag.tag}}</td>-->
<!--                    <td>{{tag.description}}</td>-->
<!--                    <td>{{tag.key}}</td>-->
<!--                    <td class="text-right">-->
<!--                        <button mat-icon-button color="warn" (click)="removeTag(tag.key)">-->
<!--                            <mat-icon>clear</mat-icon>-->
<!--                        </button>-->
<!--                    </td>-->
<!--                </tr>-->

<!--                </tbody>-->
<!--            </table>-->
<!--        </ng-template>-->

@if (addNew) {
  <div class="p-4">
    <div class="my-4">
      <p><b>{{config.tagLabel || 'Tag'}} Name</b></p>
      <input class="full" type="text" placeholder="Enter {{config.tagLabel || 'tag'}} name" [(ngModel)]="newName">
    </div>
    <div class="my-4">
      <p class="mt-1"><b>{{config.tagLabel || 'Tag'}} Description</b></p>
      <input class="full" type="text" placeholder="Enter {{config.tagLabel || 'Tag'}} description" [(ngModel)]="newDescription">
    </div>
  </div>
}


</div>

<div class="dialog-footer">
  @if (!addNew) {
    <button mat-button mat-dialog-close mat-stroked-button type="button">Close</button>
  }
  @if (addNew) {
    <button mat-button mat-stroked-button type="button" (click)="addNew = false;">Cancel</button>
  }

  @if (addNew) {
    <button mat-button mat-flat-button color="primary" type="button"
      (click)="createTag()" [disabled]="!newName || !newDescription">Create {{config.tagLabel || 'Tag'}}
    </button>
  }
</div>

</div>


