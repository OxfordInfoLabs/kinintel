<div class="container mx-auto max-w-screen-lg">

    <h2>Notification Group</h2>


    <label class="mb-4">
        Name
        <input type="text" [(ngModel)]="notification.name">
    </label>

    <label class="mb-4">
        Type
        <select [(ngModel)]="notification.communicationMethod">
            <option value="email">Email</option>
            <option value="internal">Internal</option>
        </select>
    </label>

    <label class="mb-8">
        Select Users
        <input type="text" #userSearch class="mb-2"
               placeholder="Search for a user"
               [matAutocomplete]="auto"
               (keyup)="search($event.target.value)">
        <mat-autocomplete #auto="matAutocomplete" (optionSelected)="userSelected($event, userSearch)">
            @for (user of users; track user) {
                <mat-option [value]="user">
                    {{ user.name }}
                </mat-option>
            }
        </mat-autocomplete>
        <mat-chip-set>
            @for (member of _.filter(notificationGroupMembers, 'user'); track member) {
                <mat-chip
                    [removable]="true" (removed)="_.remove(notificationGroupMembers, {user: member})">
                    {{ member.user.name }}
                    @if (removable) {
                        <mat-icon matChipRemove>cancel</mat-icon>
                    }
                </mat-chip>
            }
        </mat-chip-set>
    </label>

    <label class="mb-8">
        External Recipients
        <input type="text" class="mb-2"
               placeholder="Enter recipient data"
               (keyup.enter)="addExternalMember($event)">

        <mat-chip-set>
            @for (member of _.filter(notificationGroupMembers, 'memberData'); track member) {
                <mat-chip
                    [removable]="true"
                    (removed)="_.remove(notificationGroupMembers, {memberData: member.memberData})">
                    {{ member.memberData }}
                    @if (removable) {
                        <mat-icon matChipRemove>cancel</mat-icon>
                    }
                </mat-chip>
            }
        </mat-chip-set>
    </label>

    @if (testSent) {
        <div class="test-sent">
            <p>
                <mat-icon>check_circle</mat-icon>
            </p>
            <p>Test {{ notification.type }} has been sent to the following recipients:
                @for (recipient of notification.recipients; track recipient; let i = $index) {
                    @if (i > 0) {
                        <span>,&nbsp;</span>
                    }<b>{{ recipient }}</b>
                }
            </p>
        </div>
    }

    <div class="py-4 align-center justify-between">
        <button mat-stroked-button (click)="cancel()">
            Cancel
        </button>
        <div>
            <button mat-stroked-button class="send-test" color="primary" [disabled]="false">
                Send Test
            </button>
            <button mat-flat-button color="primary" (click)="save()">
                Save Changes
            </button>
        </div>

    </div>


</div>
