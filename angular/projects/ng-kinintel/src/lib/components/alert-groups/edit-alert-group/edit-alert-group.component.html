<div class="container mx-auto max-w-screen-lg">

    <h2>Alert Group</h2>

    <div class="bg-white p-6 content-wrapper">

        <label class="mb-4">
            Name
            <input type="text" [(ngModel)]="alertGroup.title">
        </label>

        <p><b>Time Periods</b></p>

        <div class="time-period" *ngFor="let time of alertGroup.taskTimePeriods">
            <div class="align-center justify-between">
                <div>
                    <ng-template ngFor let-key [ngForOf]="Object.keys(time)" let-i=index>
                        <ng-template [ngIf]="key !== 'id' && time[key]">
                            <span class="mr-2"><span class="capitalize"><b>{{_.startCase(key)}}:</b></span>&nbsp;<span>{{time[key]}}</span></span>
                        </ng-template>
                    </ng-template>
                </div>
                <button mat-icon-button color="warn" (click)="removeTime(i)">
                    <mat-icon>clear</mat-icon>
                </button>
            </div>
        </div>

        <button mat-button color="primary" (click)="addScheduleTime()">
            <mat-icon>more_time</mat-icon>&nbsp;Add scheduled time
        </button>

        <ng-template [ngIf]="showNewTaskTimePeriod">
            <div class="w-full bg-gray-50 p-4 mt-4">
                <form #timeForm="ngForm" class="w-1/2">
                    <label class="mb-4">
                        Frequency
                        <mat-select #frequency="ngModel" [ngClass]="{'border-red-600': frequency.invalid}"
                                    [(ngModel)]="newTaskTimePeriod.frequency" name="frequency" required>
                            <mat-option value="Monthly">Monthly</mat-option>
                            <mat-option value="Weekly">Weekly</mat-option>
                            <mat-option value="Daily">Daily</mat-option>
                            <mat-option value="Hourly">Hourly</mat-option>
                        </mat-select>
                    </label>

                    <label class="mb-4" *ngIf="['Monthly'].indexOf(newTaskTimePeriod.frequency) > -1">
                        Day of month
                        <mat-select #month="ngModel" [ngClass]="{'border-red-600': month.invalid}"
                                    [(ngModel)]="newTaskTimePeriod.dayInMonth" name="month" required>
                            <mat-option [value]="day" *ngFor="let day of _.range(1, 29)">{{day}}</mat-option>
                        </mat-select>
                    </label>

                    <label class="mb-4" *ngIf="['Weekly'].indexOf(newTaskTimePeriod.frequency) > -1">
                        Day of week
                        <mat-select #week="ngModel" [ngClass]="{'border-red-600': week.invalid}"
                                    [(ngModel)]="newTaskTimePeriod.dayOfWeek" name="week" required>
                            <mat-option [value]="1">Monday</mat-option>
                            <mat-option [value]="2">Tuesday</mat-option>
                            <mat-option [value]="3">Wednesday</mat-option>
                            <mat-option [value]="4">Thursday</mat-option>
                            <mat-option [value]="5">Friday</mat-option>
                            <mat-option [value]="6">Saturday</mat-option>
                            <mat-option [value]="7">Sunday</mat-option>
                        </mat-select>
                    </label>

                    <label class="mb-4"
                           *ngIf="['Monthly', 'Weekly', 'Daily'].indexOf(newTaskTimePeriod.frequency) > -1">
                        Hour
                        <mat-select #hour="ngModel" [ngClass]="{'border-red-600': hour.invalid}"
                                    [(ngModel)]="newTaskTimePeriod.hour" name="hour" required>
                            <mat-option [value]="hour" *ngFor="let hour of _.range(0, 24)">{{hour}}</mat-option>
                        </mat-select>
                    </label>

                    <label class="mb-4"
                           *ngIf="['Monthly', 'Weekly', 'Daily', 'Hourly'].indexOf(newTaskTimePeriod.frequency) > -1">
                        Minute
                        <mat-select #minute="ngModel" [ngClass]="{'border-red-600': minute.invalid}"
                                    [(ngModel)]="newTaskTimePeriod.minute" name="minute" required>
                            <mat-option [value]="minute" *ngFor="let minute of _.range(0, 60)">{{minute}}</mat-option>
                        </mat-select>
                    </label>

                    <div class="align-center justify-between">
                        <div></div>
                        <button mat-flat-button color="primary" (click)="addTimePeriod()"
                                [disabled]="timeForm.invalid">Add time period
                        </button>
                    </div>
                </form>
            </div>

        </ng-template>


        <label class="my-4">
            Notification Groups
            <mat-select [(ngModel)]="alertGroup.notificationGroups" multiple>
                <mat-option [value]="group" *ngFor="let group of notificationGroups">{{group.name}}</mat-option>
            </mat-select>
        </label>
        <button mat-button color="primary" (click)="createNotificationGroup()">
            <mat-icon>group_add</mat-icon>&nbsp;Create new notification group
        </button>

        <div class="py-4 align-center justify-between">
            <button mat-stroked-button [routerLink]="['/alert-groups']">
                Cancel
            </button>
            <div>
                <button mat-flat-button color="primary" (click)="save()"
                        [disabled]="!alertGroup.title || (!alertGroup.taskTimePeriods || !alertGroup.taskTimePeriods.length) || (!alertGroup.notificationGroups || !alertGroup.notificationGroups.length)">
                    Save Changes
                </button>
            </div>
        </div>

    </div>

</div>
