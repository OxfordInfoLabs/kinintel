<div class="container mx-auto max-w-screen-lg mb-4">

    <div class="bg-white p-6 content-wrapper">
        <div class="pb-6 flex align-center justify-between">
            <div class="flex justify-between w-full items-center mb-4">
                <h3 class="mb-0 text-lg leading-6 font-medium text-gray-900">
                    {{'Feeds'}}
                </h3>
                <button mat-flat-button color="primary" (click)="editFeed()">Create New Feed</button>
            </div>
        </div>

        <div class="mb-8">
            <input class="full" type="text" placeholder="Search for a feed"
                   (keyup)="searchText.next($event.target.value)">
        </div>

        <table>
            <thead>
            <tr>
                <th>Path</th>
                <th>Dataset</th>
                <th>Parameters</th>
                <th></th>
            </tr>
            </thead>
            <tbody *ngFor="let feed of datasets">
                <tr>
                    <td [ngClass]="{'border-0': feed._showExample}">
                        <div class="flex items-center">
                            {{feedUrl}}{{feed.path}}
                            <mat-icon color="primary" class="ml-2 text-sm cursor-pointer"
                                      (click)="feed._showExample = !feed._showExample">info_outline</mat-icon>
                        </div>
                    </td>
                    <td [ngClass]="{'border-0': feed._showExample}">
                        <a class="primary hover:underline font-medium"
                           (click)="view(feed.datasetInstanceId)">
                            {{feed.datasetLabel.title}}</a>
                    </td>
                    <td [ngClass]="{'border-0': feed._showExample}">
                        {{feed.exposedParameterNames.join(', ')}}
                    </td>
                    <td class="pr-0" [ngClass]="{'border-0': feed._showExample}">
                        <div class="flex items-center justify-end">
                            <button mat-button color="primary" (click)="editFeed(feed)"> Edit</button>
                            <div class="divider"></div>
                            <button color="primary" mat-icon-button [matMenuTriggerFor]="itemMenu">
                                <mat-icon>more_vert</mat-icon>
                            </button>
                            <mat-menu #itemMenu="matMenu">
                                <button mat-menu-item (click)="delete(feed.id)">Delete Feed</button>
                            </mat-menu>
                        </div>
                    </td>
                </tr>
                <tr *ngIf="feed._showExample">
                    <td class="pt-0 pr-0 pl-0" colspan="4">
                        <div class="tracking-wider font-bold">cURL</div>
                        <pre class="block bg-gray-800 text-gray-100 pt-2 pl-2 rounded-t whitespace-normal">
curl -H "API-KEY:<b>[[apiKey]]</b>" -H "API-SECRET:<b>[[apiSecret]]</b>"</pre>
                        <pre class="block bg-gray-800 text-gray-100 pb-2 pl-2 rounded-b whitespace-normal mb-6">-X GET {{feedUrl}}{{feed.path}}<ng-template ngFor let-param [ngForOf]="feed.exposedParameterNames" let-i=index>{{i === 0 ? '?' : '&'}}{{param}}=<b>[[VALUE]]</b></ng-template></pre>
                        <div class="tracking-wider font-bold">HTTPS</div>
                        <pre class="block bg-gray-800 text-gray-100 p-2 rounded whitespace-normal">{{feedUrl}}{{feed.path}}?apiKey=<b>[[apiKey]]</b>&apiSecret=<b>[[apiSecret]]</b><ng-template ngFor let-param [ngForOf]="feed.exposedParameterNames">&{{param}}=<b>[[VALUE]]</b></ng-template></pre>
                    </td>
                </tr>
            </tbody>
        </table>


        <mat-paginator [length]="datasets.length"
                       [pageSize]="10"
                       [pageSizeOptions]="[5, 10, 25, 100]">
        </mat-paginator>
    </div>

</div>
