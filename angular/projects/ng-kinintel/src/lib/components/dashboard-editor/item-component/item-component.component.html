<div class="alert-panel" *ngIf="showAlertData" (click)="showAlertData = false">
    <div class="align-center flex-col w-3/4 m-auto">
        <mat-icon>notification_important</mat-icon>
        <h2 class="mb-0">Alert Notification</h2>
        <p class="text-center">The following alerts have been triggered based on the criteria set for this dashboard
            item...</p>
        <div class="alert-item mb-2" *ngFor="let alertItem of alertData"
             [innerHTML]="alertItem.notificationMessage">
        </div>
    </div>
</div>

<ng-template [ngIf]="dragItem">
    <mat-icon>{{dashboardItemType.icon}}</mat-icon>
    {{dashboardItemType.label}}
</ng-template>
<div class="alert-widget" *ngIf="alert" (click)="showAlertData = true;">
    <button mat-icon-button>
        <mat-icon>notification_important</mat-icon>
    </button>
    <div class="alert-summaries">
        <span class="mr-2" *ngFor="let alertItem of alertData">
            {{alertItem.summaryMessage}}
        </span>
    </div>
</div>

<ng-template
    [ngIf]="!dragItem && !dashboardDatasetInstance && !dashboardItemType.headingValue && !dashboardItemType._editing">
    <button mat-stroked-button color="primary" (click)="configure()">
        Configure {{dashboardItemType.label}}
    </button>
</ng-template>

<div class="loading-item" *ngIf="!dragItem && loadingItem">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Loading {{dashboardItemType.label}} ...</p>
</div>

<button *ngIf="!dragItem && (!viewOnly || viewOnly && editAlerts)" mat-icon-button class="edit-widget" [matMenuTriggerFor]="editMenu">
    <mat-icon>more_vert</mat-icon>
</button>
<mat-menu #editMenu="matMenu">
    <ng-template [ngIf]="viewOnly && editAlerts">
        <button mat-menu-item (click)="configure()">Edit Alerts</button>
    </ng-template>
    <ng-template [ngIf]="!viewOnly">
        <button mat-menu-item (click)="configure()">Edit Item</button>
        <button mat-menu-item (click)="removeWidget($event)">Delete Item</button>
    </ng-template>
</mat-menu>

<ng-template [ngIf]="!dragItem && dashboardItemType.type === 'heading'">

    <div class="item-heading" *ngIf="!dashboardItemType._editing">
        {{bindParametersInString(dashboardItemType.headingValue)}}
    </div>

    <input type="text" *ngIf="dashboardItemType._editing" [(ngModel)]="dashboardItemType.headingValue"
           (blur)="updateHeading($event)" class="w-11/12">

</ng-template>

<ng-template [ngIf]="!dragItem && !loadingItem && (chartData || dataset)">
    <div class="item-title" [ngClass]="{'mb-4': !general.description, 'mb-2': general.description}"
         *ngIf="general.name">{{general.name}}</div>
    <div class="item-description" *ngIf="general.description">{{general.description}}</div>

    <div class="item-container" [ngClass]="{'flex justify-center': dashboardItemType.type === 'image'}">

        <div [id]="dashboardItemType.type + itemInstanceKey" *ngIf="dashboardItemType.type === 'text'"
            [innerHTML]="bindParametersInString(textData.value)"></div>

        <ng-template [ngIf]="dashboardItemType.type === 'metric'">
            <div class="metric-item">
                <div class="main">{{metricData.mainValue}}</div>
                <div class="sub-metric" [innerHTML]="metricData.subValue"></div>
            </div>
        </ng-template>

        <ng-template [ngIf]="dashboardItemType.type === 'image'">
            <img *ngIf="imageData.source" [src]="imageData.source" alt="" class="w-auto h-full"
                (error)="imageError = true">
            <div *ngIf="!imageData.source || imageError" class="relative flex items-center justify-center">
                <p class="z-10 text-lg">No image</p>
                <svg xmlns="http://www.w3.org/2000/svg" class="filter blur-sm absolute w-auto h-full text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
            </div>
        </ng-template>

        <canvas baseChart *ngIf="chartData" style="height: 200px"
                [datasets]="chartData"
                [labels]="dashboardItemType.labels"
                [options]="{responsive: true}"
                [colors]="[{borderColor: dashboardItemType.borderColor,backgroundColor: dashboardItemType.backgroundColor}]"
                [legend]="!!dashboardItemType.legend"
                [chartType]="dashboardItemType.type"
                [plugins]="[]">
        </canvas>

        <ng-template [ngIf]="dashboardItemType.type === 'table'">

            <table>
                <thead>
                <tr>
                    <th *ngFor="let column of dataset.columns">{{column.title}}</th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let dataItem of dataset.allData"
                    [ngClass]="{'hover:bg-gray-50 cursor-pointer': tabularData.actionRows}"
                    (click)="tabularData.actionRows ? callToActionLink(tabularData.cta, dataItem) : null">
                    <td *ngFor="let column of dataset.columns">{{dataItem[column.name]}}</td>
                </tr>
                </tbody>
            </table>

        </ng-template>

    </div>

    <div class="actions" *ngIf="callToAction && Object.keys(callToAction).length">
        <button mat-button color="primary" (click)="callToActionLink(callToAction)">
            {{callToAction.label}}
            <mat-icon>chevron_right</mat-icon>
        </button>
    </div>

</ng-template>
