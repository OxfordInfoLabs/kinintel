<div class="alert-panel" *ngIf="showAlertData" (click)="showAlertData = false">
    <div class="align-center flex-col w-3/4">
        <mat-icon>notification_important</mat-icon>
        <h2 class="mb-0">Alert Notification</h2>
        <p class="text-center">The following alerts have been triggered based on the criteria set for this dashboard item...</p>
        <div class="alert-item mb-2" *ngFor="let alertItem of alertData">
            {{alertItem.notificationMessage}}
        </div>
    </div>
</div>

<ng-template [ngIf]="dragItem">
    <mat-icon>{{dashboardItemType.icon}}</mat-icon>
    {{dashboardItemType.label}}
</ng-template>
<div class="alert-widget" *ngIf="alert" (click)="showAlertData = true;">
    <button mat-icon-button>
        <mat-icon>notification_important</mat-icon>
    </button>
    <div class="alert-summaries">
        <span class="mr-2" *ngFor="let alertItem of alertData">
            {{alertItem.summaryMessage}}
        </span>
    </div>
</div>

<ng-template
    [ngIf]="!dragItem && !dashboardDatasetInstance && !dashboardItemType.headingValue && !dashboardItemType._editing">
    <button mat-stroked-button color="primary" (click)="configure()">
        Configure {{dashboardItemType.label}}
    </button>
</ng-template>

<div class="loading-item" *ngIf="!dragItem && loadingItem">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Loading {{dashboardItemType.label}} ...</p>
</div>

<button *ngIf="!dragItem" mat-icon-button class="edit-widget" [matMenuTriggerFor]="editMenu">
    <mat-icon>more_vert</mat-icon>
</button>
<mat-menu #editMenu="matMenu">
    <button mat-menu-item (click)="configure()">Edit Item</button>
    <button mat-menu-item (click)="removeWidget($event)">Delete Item</button>
</mat-menu>

<ng-template [ngIf]="!dragItem && dashboardItemType.type === 'heading'">

    <div class="item-heading" *ngIf="!dashboardItemType._editing">
        {{dashboardItemType.headingValue}}
    </div>

    <input type="text" *ngIf="dashboardItemType._editing" [(ngModel)]="dashboardItemType.headingValue"
           (blur)="updateHeading($event)">

</ng-template>

<ng-template [ngIf]="!dragItem && !loadingItem && (chartData || dataset)">
    <div class="item-title" [ngClass]="{'mb-4': !general.description, 'mb-2': general.description}"
         *ngIf="general.name">{{general.name}}</div>
    <div class="item-description" *ngIf="general.description">{{general.description}}</div>

    <div class="item-container">

        <ng-template [ngIf]="dashboardItemType.type === 'metric'">
            <div class="metric-item">
                <div class="main">{{metricData.mainValue}}</div>
                <div class="sub-metric" [innerHTML]="metricData.subValue"></div>
            </div>
        </ng-template>

        <canvas baseChart *ngIf="chartData" style="height: 200px"
                [datasets]="chartData"
                [labels]="dashboardItemType.labels"
                [options]="{responsive: true}"
                [colors]="[{borderColor: dashboardItemType.borderColor,backgroundColor: dashboardItemType.backgroundColor}]"
                [legend]="!!dashboardItemType.legend"
                [chartType]="dashboardItemType.type"
                [plugins]="[]">
        </canvas>

        <ng-template [ngIf]="dashboardItemType.type === 'table'">

            <table>
                <thead>
                <tr>
                    <th *ngFor="let column of dataset.columns">{{column.title}}</th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let dataItem of dataset.allData">
                    <td *ngFor="let column of dataset.columns">{{dataItem[column.name]}}</td>
                </tr>
                </tbody>
            </table>

        </ng-template>

    </div>

    <div class="actions" *ngIf="general.cta">
        <button mat-button color="primary" (click)="callToAction()">
            {{general.cta.label}}
            <mat-icon>chevron_right</mat-icon>
        </button>
    </div>

</ng-template>
