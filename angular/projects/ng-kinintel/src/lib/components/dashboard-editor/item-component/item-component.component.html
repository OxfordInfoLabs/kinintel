<div class="alert-panel" *ngIf="showAlertData" (click)="showAlertData = false">
    <div class="align-center flex-col w-3/4 m-auto">
        <mat-icon>notification_important</mat-icon>
        <h2 class="mb-0">Alert Notification</h2>
        <p class="text-center">The following alerts have been triggered based on the criteria set for this dashboard
            item...</p>
        <div class="alert-item mb-2" *ngFor="let alertItem of alertData"
             [innerHTML]="alertItem.notificationMessage">
        </div>
    </div>
</div>

<div class="item-disabled">
    <p>{{general.name || dashboardItemType.label}}</p>
    <mat-icon>block</mat-icon>
    <p class="disabled-notice">{{dependencies.notice || 'No Data Available'}}</p>
</div>

<ng-template [ngIf]="dragItem">
    <mat-icon>{{dashboardItemType.icon}}</mat-icon>
    {{dashboardItemType.label}}
</ng-template>
<div class="alert-widget" *ngIf="alert" (click)="showAlertData = true;">
    <button mat-icon-button>
        <mat-icon>notification_important</mat-icon>
    </button>
    <div class="alert-summaries">
        <span class="mr-2" *ngFor="let alertItem of alertData">
            {{alertItem.summaryMessage}}
        </span>
    </div>
</div>

<ng-template
    [ngIf]="!dragItem && !dashboardDatasetInstance && !dashboardItemType.headingValue && !dashboardItemType._editing">
    <button mat-stroked-button color="primary" class="config-button" (click)="configure()">
        Configure {{dashboardItemType.label}}
    </button>
</ng-template>

<div class="loading-item" *ngIf="!dragItem && loadingItem">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Loading {{general.name || dashboardItemType.label}} ...</p>
</div>

<button *ngIf="!dragItem && (!viewOnly || viewOnly && editAlerts)" mat-icon-button class="edit-widget"
        [matMenuTriggerFor]="editMenu">
    <mat-icon>more_vert</mat-icon>
</button>
<mat-menu #editMenu="matMenu">
    <ng-template [ngIf]="viewOnly && editAlerts">
        <button mat-menu-item (click)="configure()">Edit Alerts</button>
    </ng-template>
    <ng-template [ngIf]="!viewOnly">
        <button mat-menu-item (click)="configure()">Edit Item</button>
        <button mat-menu-item (click)="removeWidget($event)">Delete Item</button>
    </ng-template>
</mat-menu>

<ng-template [ngIf]="!dragItem && dashboardItemType.type === 'heading'">

    <div class="item-heading" *ngIf="!dashboardItemType._editing">
        {{bindParametersInString(dashboardItemType.headingValue)}}
    </div>

    <input type="text" *ngIf="dashboardItemType._editing" [(ngModel)]="dashboardItemType.headingValue"
           (blur)="updateHeading($event)" class="w-11/12">

</ng-template>

<ng-template [ngIf]="!dragItem && !loadingItem && (chartData || dataset)">
    <div class="item-title dark:text-gray-100" *ngIf="general.name" [innerHTML]="general.evaluatedName"
         [ngClass]="{'mb-4': !general.description, 'mb-2': general.description}"></div>

    <div class="item-description dark:text-gray-200" *ngIf="general.description"
         [innerHTML]="general.evaluatedDescription"></div>

    <div class="item-container"
         [ngClass]="{'flex justify-center': dashboardItemType.type === 'image', 'p-0': dashboardItemType.type === 'table'}">

        <ng-template [ngIf]="dashboardItemType.type === 'text' && textData.value">
            <div *ngIf="textData.safeTextData" [innerHTML]="textData.safeTextData"></div>
        </ng-template>

        <ng-template [ngIf]="dashboardItemType.type === 'metric'">
            <div class="metric-item">
                <div class="main">{{metric.mainValue}}</div>
                <div class="sub-metric" [innerHTML]="metric.subValue"></div>
            </div>
        </ng-template>

        <ng-template [ngIf]="dashboardItemType.type === 'image'">
            <div class="w-auto h-full">
                <img *ngIf="imageData.source" [src]="imageData.source" alt=""
                     (error)="imageError = true">
            </div>

            <div *ngIf="!imageData.source || imageError" class="relative flex items-center justify-center">
                <p class="z-10 text-lg">No image</p>
                <svg xmlns="http://www.w3.org/2000/svg" class="filter blur-sm absolute w-auto h-full text-gray-300"
                     fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                </svg>
            </div>
        </ng-template>

        <canvas baseChart *ngIf="chartData" style="height: 200px"
                [datasets]="chartData"
                [labels]="dashboardItemType.labels"
                [options]="{responsive:true, maintainAspectRatio: false}"
                [colors]="[{borderColor: dashboardItemType.borderColor,backgroundColor: dashboardItemType.backgroundColor}]"
                [legend]="!!dashboardItemType.legend"
                [chartType]="dashboardItemType.type"
                [plugins]="[]">
        </canvas>

        <ng-template [ngIf]="dashboardItemType.type === 'table'">

            <table class="min-w-full border-separate" style="border-spacing: 0">
                <thead class="bg-gray-50 dark:bg-gray-600">
                <tr>
                    <th scope="col"
                        class="sticky top-0 z-10 border-b border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-600 bg-opacity-75 p-3 text-left text-xs font-semibold text-gray-900 dark:text-gray-100 backdrop-blur backdrop-filter"
                        *ngFor="let column of dataset.columns">{{column.title}}</th>
                </tr>
                </thead>
                <tbody class="bg-white dark:bg-gray-700">
                <tr *ngFor="let dataItem of dataset.allData"
                    [ngClass]="{'hover:bg-gray-50 cursor-pointer': tabular.actionRows}"
                    (click)="tabular.actionRows ? callToActionLink(tabular.cta, dataItem) : null">
                    <td class="whitespace-nowrap border-b border-gray-200 dark:border-gray-600 px-3 py-2 text-sm text-gray-500 dark:text-gray-200"
                        [ngClass]="{'font-medium text-gray-900': i === 0}"
                        *ngFor="let column of dataset.columns; let i = index">
                        <ng-template [ngIf]="dataItem[column.name] && String(dataItem[column.name]).length <= 100">
                            {{dataItem[column.name]}}
                        </ng-template>
                        <ng-template [ngIf]="dataItem[column.name] && String(dataItem[column.name]).length > 100">
                            <div
                                [title]="dataItem[column.name]">{{dataItem[column.name].substring(0, 100) + '...'}}</div>
                        </ng-template>
                        <ng-template [ngIf]="!dataItem[column.name]">
                            {{dataItem[column.name]}}
                        </ng-template>
                    </td>
                </tr>
                </tbody>
            </table>
            <div class="p-4 sticky left-0 flex items-center justify-between">
                <select [value]="limit" (change)="pageSizeChange($event.target.value)"
                        class="mr-8 dark:bg-gray-700 dark:text-gray-200 dark:border-gray-600">
                    <option [value]="1">1</option>
                    <option [value]="5">5</option>
                    <option [value]="10">10</option>
                    <option [value]="25">25</option>
                    <option [value]="50">50</option>
                    <option [value]="100">100</option>
                    <option [value]="250">250</option>
                    <option [value]="1000">1000</option>
                </select>
                <div>
                    <button mat-icon-button class="mr-4" (click)="decreaseOffset()" [disabled]="page <= 1">
                        <mat-icon>chevron_left</mat-icon>
                    </button>
                    <button mat-icon-button (click)="increaseOffset()" [disabled]="endOfResults">
                        <mat-icon>chevron_right</mat-icon>
                    </button>
                </div>

            </div>
        </ng-template>

    </div>

    <div class="w-full bg-gray-50 px-5 py-1 text-gray-600 border-b border-gray-200 text-xs"
         [ngClass]="{'border-b': callToAction && Object.keys(callToAction).length}"
         *ngIf="general.footer" [innerHTML]="general.evaluatedFooter"></div>

    <div class="w-full bg-gray-50 px-5 py-3" *ngIf="callToAction && Object.keys(callToAction).length">
        <div class="text-sm">
            <a class="font-medium text-indigo-700 hover:text-indigo-900 flex items-center"
               (click)="callToActionLink(callToAction)">
                {{callToAction.label}}
                <mat-icon>chevron_right</mat-icon>
            </a>
        </div>
    </div>

</ng-template>
