@if (true) {
    <div class="align-center justify-between flex-wrap bg-white px-2 border-b border-gray-200">
        @if (editDashboardTitle) {
            <div class="align-center ml-2">
                <input type="text" class="title-input py-1.5" placeholder="Enter dashboard title"
                       [(ngModel)]="dashboard.title"
                       [class]="{'border-red-600': !dashboard.title || dashboard.title === 'New Dashboard'}">&nbsp;
            </div>
        }
        @if (!editDashboardTitle) {
            <div class="align-center ml-2">
                <h2 class="dashboard-title">{{ dashboard.title }}</h2>&nbsp;
                <button mat-icon-button (click)="editDashboardTitle = true;">
                    <span class="material-symbols-outlined">edit</span>
                </button>
            </div>
        }
        <div class="data-actions">
            @if (admin) {
                <mat-radio-group class="dashboard-operations flex items-center text-sm"
                                 aria-label="Select a scope" [(ngModel)]="accountId">
                    <mat-radio-button class="mt-0" [value]="null">Shared</mat-radio-button>
                    <mat-radio-button class="mt-0 ml-2" [value]="0">Private</mat-radio-button>
                </mat-radio-group>
            }
            @if (admin) {
                <div class="divider"></div>
            }
            <button matTooltip="Toggle setting to enable/remove results limit" (click)="togglePerformance()"
                    class="w-20 flex flex-col items-center justify-center py-1 px-2 text-xs text-gray-600 cursor-pointer hover:bg-gray-100">
                @if (optimise) {
                    <span class="text-xl material-symbols-outlined">check_circle</span>
                }
                @if (!optimise) {
                    <span class="text-xl material-symbols-outlined">unpublished</span>
                }
                optimise
            </button>
            <button matTooltip="Edit dashboard settings" (click)="openSettings()"
                    class="w-20 flex flex-col items-center justify-center py-1 px-2 text-xs text-gray-600 cursor-pointer hover:bg-gray-100">
                <span class="material-symbols-outlined text-xl">tune</span>
                settings
            </button>
            <button (click)="toggleNotifications()" matTooltip="Edit default notification group"
                    class="w-20 flex flex-col items-center justify-center py-1 px-2 text-xs text-gray-600 cursor-pointer hover:bg-gray-100">
                @if (!dashboard.alertsEnabled) {
                    <span class="material-symbols-outlined text-xl"
                          title="Notifications for this dashboard are now off. Press to toggle on.">notifications_off
          </span>
                }
                @if (dashboard.alertsEnabled) {
                    <span class="material-symbols-outlined text-xl"
                          title="Notifications for this dashboard are on. Press to toggle off.">notifications_active
          </span>
                }
                notifications
            </button>
            <button [matMenuTriggerFor]="spacingMenu" matTooltip="Set dashboard item spacing"
                    class="w-20 flex flex-col items-center justify-center py-1 px-2 text-xs text-gray-600 cursor-pointer hover:bg-gray-100">
                <span class="material-symbols-outlined text-xl">grid_view</span>
                spacing
            </button>
            <mat-menu #spacingMenu="matMenu">
                @for (space of gridSpaces; track space) {
                    <button mat-menu-item (click)="updateGridSpacing(space.value)">
                        {{ space.label }}
                    </button>
                }
            </mat-menu>
            <button (click)="openFullScreen()" matTooltip="View full screen"
                    class="w-20 flex flex-col items-center justify-center py-1 px-2 text-xs text-gray-600 cursor-pointer hover:bg-gray-100">
                <span class="material-symbols-outlined text-xl">fullscreen</span>
                full screen
            </button>
            <button (click)="editDashboardItems()" matTooltip="Show/hide dashboard widget panel"
                    class="w-20 flex flex-col items-center justify-center py-1 px-2 text-xs text-gray-600 cursor-pointer hover:bg-gray-100">
                <span class="material-symbols-outlined text-xl">widgets</span>
                widgets
            </button>
            <div class="divider"></div>
            <button (click)="reloadDashboard()"
                    class="w-20 flex flex-col items-center justify-center py-1 px-2 text-xs text-gray-600 cursor-pointer hover:bg-gray-100">
                <span class="material-symbols-outlined text-xl">sync</span>
                reload
            </button>
            <button (click)="save()"
                    class="w-20 flex flex-col items-center justify-center py-1 px-2 text-xs text-gray-600 cursor-pointer hover:bg-gray-100">
                <span class="material-symbols-outlined text-xl">save</span>
                save
            </button>
        </div>
    </div>
    @if (dashboard.layoutSettings) {
        <div class="dashboard-parameters flex-wrap bg-gray-50 px-4 py-0.5 border-b border-gray-200">
            <div class="list-title">
                Parameters
            </div>
            @for (parameter of _.values(dashboard.layoutSettings.parameters); track parameter; let i = $index) {
                <label>
                    {{ parameter.title }}
                    <div class="parameter-input">
                        @if (parameter.type === 'text') {
                            <input type="text" placeholder="Enter {{parameter.title}}" [(ngModel)]="parameter.value"
                                   (keyup.enter)="reloadDashboard()" required autofocus>
                        }
                        @if (parameter.type === 'numeric') {
                            <input type="number" placeholder="Enter {{parameter.title}}" [(ngModel)]="parameter.value"
                                   (keyup.enter)="reloadDashboard()" required autofocus>
                        }
                        @if (parameter.type === 'list') {
                            <select class="pr-8 py-1.5 pl-1" [(ngModel)]="parameter.value"
                                    (change)="reloadDashboard()" required autofocus>
                                @for (item of parameter.list; track item) {
                                    <option [value]="item.value">{{ item.label }}</option>
                                }
                            </select>
                        }
                        @if (parameter.type === 'date' || parameter.type === 'datetime') {
                            @if (!parameter._dateType) {
                                <div class="flex items-center">
                                    <button (click)="changeDateType($event, parameter, 'picker')"
                                            class="hover:bg-gray-50 text-gray-800 border border-gray-300 py-0.5 pr-2 rounded mr-2 bg-white flex items-center">
                                        <span class="material-symbols-outlined text-base mx-1">calendar_month</span>
                                        Date Picker
                                    </button>
                                    <button (click)="changeDateType($event, parameter, 'period')"
                                            class="hover:bg-gray-50 text-gray-800 border border-gray-300 py-0.5 pr-2 rounded bg-white flex items-center">
                                        <span class="material-symbols-outlined text-base mx-1">restore</span>
                                        Time Period
                                    </button>
                                </div>
                            }
                            @if (parameter._dateType === 'picker') {
                                <input [type]="parameter.type === 'date' ? 'date' : 'datetime-local'"
                                       placeholder="Enter {{parameter.title}}" [(ngModel)]="parameter.value"
                                       (keyup.enter)="reloadDashboard()" required autofocus>
                                <a (click)="changeDateType($event, parameter, 'period')"
                                   matTooltip="Time Period"
                                   class="text-center ml-2 hover:bg-gray-50 text-gray-800 border border-gray-300 py-0.5 pr-0.5 rounded mr-2 bg-white flex items-center">
                                    <span class="material-symbols-outlined text-base ml-1.5 mr-1">restore</span>
                                </a>
                            }
                            @if (parameter._dateType === 'period') {
                                <div class="flex items-center">
                                    <input #periodValue type="number" placeholder="No." required autofocus
                                           class="w-16 mr-2" min="0" [value]="parameter._periodValue || 1"
                                           (change)="updatePeriodValue(periodValue.value, period.value, parameter)">
                                    <select class="param-period-picker mr-2" [value]="parameter._period || 'DAYS'"
                                            #period
                                            (change)="updatePeriodValue(periodValue.value, period.value, parameter)">
                                        <option value="DAYS">Days</option>
                                        <option value="HOURS">Hours</option>
                                    </select>
                                    <div>Ago</div>
                                </div>
                                <a (click)="changeDateType($event, parameter, 'picker')"
                                   matTooltip="Date Picker"
                                   class="text-center ml-2 hover:bg-gray-50 text-gray-800 border border-gray-300 py-0.5 pr-0.5 rounded mr-2 bg-white flex items-center">
                                    <span class="material-symbols-outlined text-base">calendar_month</span>
                                </a>
                            }
                        }
                        @if (parameter.type === 'boolean') {
                            <mat-slide-toggle class="pr-4" color="primary"
                                              [checked]="parameter.value" (change)="booleanUpdate($event, parameter)"
                                              required></mat-slide-toggle>
                        }
                        @if (!parameter._locked) {
                            <button mat-icon-button [matMenuTriggerFor]="paramMenu">
                                <span class="material-symbols-outlined">settings</span>
                            </button>
                            <mat-menu #paramMenu="matMenu">
                                <button mat-menu-item (click)="addParameter(parameter, i)">Edit Parameter</button>
                                <button mat-menu-item (click)="removeParameter(parameter)">Remove Parameter</button>
                            </mat-menu>
                        }
                    </div>
                </label>
                @if (_.values(dashboard.layoutSettings.parameters).length) {
                    <div class="divider ml-2"></div>
                }
            }
            <button mat-icon-button color="primary" class="mx-2" (click)="addParameter()">
                <span class="material-symbols-outlined">add_circle</span>
            </button>
            @if (_.values(dashboard.layoutSettings.parameters).length) {
                <button mat-flat-button color="primary" class="mr-2 leading-8"
                        (click)="reloadDashboard()">
                    Apply Parameters
                </button>
            }
        </div>
    }
}
<div class="grid-container flex justify-between">
    <div class="grid-stack flex-1 h-full"></div>
    <div class="right-panel bg-transparent" [class]="{show: showEditPanel}">
        <div class="flex items-center justify-between border-b mb-4">
            <div class="pl-4 available-widgets">Available Widgets</div>
            <button mat-icon-button color="primary" (click)="editDashboardItems()">
                <span class="material-symbols-outlined">close</span>
            </button>
        </div>
        @for (group of itemTypeGroups; track group; let j = $index) {
            <div class="pl-4 uppercase text-xs text-gray-600 tracking-wider">{{ group }}</div>
            <div class="draggable-toolbar">
                @for (item of itemTypesByGroup[group]; track item; let i = $index) {
                    <div class="grid-stack-item ui-draggable" [attr.gs-w]="item.width"
                         [attr.gs-h]="item.height" [attr.data-index]="i" [attr.data-group]="group">
                        <div class="grid-stack-item-content shadow" draggable="true">
                            <ki-item-component class="p-0 justify-center text-sm" [dragItem]="true"
                                               [dashboardItemType]="item"></ki-item-component>
                        </div>
                    </div>
                }
            </div>
        }

    </div>
</div>

